{{extend 'layout.html'}}

<script src="{{=URL('static','js/trade.js')}}"></script>
<link rel="stylesheet" type="text/css" href="{{=URL('static','css/trade.css')}}">
<div class="container">

    <div class="receiverUsernamePanel">
        <form class="form-inline" action="">
            <label for='trader_username'>Select User: &nbsp;</label><input class="form-control" name='trader_username' type='search' value="{{=(trader_username if trader_username is not None else '')}}">
            <input type='submit' value='Submit'>
        </form>
    </div>
    <!-- TODO: create search features for multi-selects -->
    <div class="clearfix">
        <div class="col-md-6 tradeborder">
            {{if editable:}}
            <div class="panel panel-default">

                <div class="panel-heading">
                    <h2 class="panel-title">You have</h2>
                </div>

                <div class="panel-body">

                    <div id="searchItems" class="form-inline">
                        <input type="text" class="form-control" id="searchOwnItems" placeholder="Search your items">
                        <button type="submit" class="btn btn-default">Submit</button>
                    </div>

                    <select id="ownAvailableObjects" multiple size="5" class="form-control">
                    {{for row in available_objects[0]:}}
                        <option value="{{=row.id}}">{{=row.name}}</option>
                    {{pass}}
                    </select>

                    <div class="pull-right">
                        <button type="submit" class="btn btn-default" onclick="transferOptions($('#ownAvailableObjects'), $('#ownTradeObjects'))">Add item</button>
                    </div>
                </div>
            </div>
            {{pass}}
            <div class="panel panel-default">

                <div class="panel-heading">
                    <h2 class="panel-title">{{=("You give" if editable else "you gave")}}</h2>
                </div>

                <div class="panel-body">
                    <div id="searchItems" class="form-inline">
                        <input type="text" class="form-control" id="searchOwnItems" placeholder="Search your items">
                        <button type="submit" class="btn btn-default">Submit</button>
                    </div>
                    {{if editable:}}
                    <select id="ownTradeObjects" multiple size="5" class="form-control">
                    {{else:}}
                    <select id="ownTradeObjects" disabled multiple size="5" class="form-control">
                    {{pass}}
                    {{for row in trade_objects[0]:}}
                        <option value="{{=row.id}}">{{=row.name}}</option>
                    {{pass}}
                    </select>
                    {{if editable:}}
                    <div class="pull-right">
                        <button type="submit" class="btn btn-default" onclick="transferOptions($('#ownTradeObjects'), $('#ownAvailableObjects'))">Remove item</button>
                    </div>
                    {{pass}}
                </div>
            </div>
        </div>

        <div class="col-md-6">
            {{if editable:}}
            <div class="panel panel-default">

                <div class="panel-heading">
                    <h2 class="panel-title">He has</h2>
                </div>

                <div class="panel-body">

                    <div id="searchItems" class="form-inline">
                        <input type="text" class="form-control" id="searchOwnItems" placeholder="Search their items">
                        <button type="submit" class="btn btn-default">Submit</button>
                    </div>

                    <select id="theirAvailableObjects" multiple size="5" class="form-control">
                        {{for row in available_objects[1]:}}
                            <option value="{{=row.id}}">{{=row.name}}</option>
                        {{pass}}
                    </select>
                    <div class="pull-right">
                        <button type="submit" class="btn btn-default" onclick="transferOptions($('#theirAvailableObjects'), $('#theirTradeObjects'))">Add item</button>
                    </div>
                </div>
            </div>
            {{pass}}
            <div class="panel panel-default">

                <div class="panel-heading">
                    <h2 class="panel-title">{{=("He gives" if editable else "He gave")}}</h2>
                </div>

                <div class="panel-body">

                    <div id="searchItems" class="form-inline">
                        <input type="text" class="form-control" id="searchOwnItems" placeholder="Search their items">
                        <button type="submit" class="btn btn-default">Submit</button>
                    </div>
                    {{if editable:}}
                    <select id="theirTradeObjects" multiple size="5" class="form-control">
                    {{else:}}
                    <select id="theirTradeObjects" disabled multiple size="5" class="form-control">
                    {{pass}}
                    {{for row in trade_objects[1]:}}
                        <option value="{{=row.id}}">{{=row.name}}</option>
                    {{pass}}
                    </select>
                    {{if editable:}}
                    <div class="pull-right">
                        <button type="submit" class="btn btn-default" onclick="transferOptions($('#theirTradeObjects'), $('#theirAvailableObjects'))">Remove item</button>
                    </div>
                    {{pass}}
                </div>
            </div>
        </div>
    </div>


    <div class="clearfix">
        {{if editable:}}
        <div class="pull-left">
            <a type="submit" name="filtered" class="btn btn-danger" href="{{=URL('trade', 'home')}}">Cancel</a>
        </div>
        <div class="pull-right">
            <button type="submit" name="filtered" class="btn btn-success" onclick="submitproposal('{{=user_id}}', '{{=trader_id}}', $('#ownTradeObjects'), $('#theirTradeObjects'))">Send trade proposal</button>
        </div>
        {{else:}}
            {{if status==0:}}
            <p> Trade is currently pending.</p>
            {{elif status==1:}}
            <p> Trade was cancelled.</p>
            {{elif status==2:}}
            <p> Trade was rejected by receiver.</p>
            {{elif status==3:}}
            <p> Trade was accepted by receiver.</p>
            {{elif status==4:}}
            <p> Trade was modified.</p>
            {{pass}}
        {{pass}}
    </div>
    <!--<div class="clearfix">
    {{=available_objects[0]}}
    {{ = (available_objects[1] if trader_username is not ''  else '')}}
    </div>
    -->
</div>
